<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fiat-Shamir Demo</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <h1>Fiat-Shamir Zero-Knowledge Proof</h1>
    <p>A (Beweiser:in) möchte B (Prüfer:in) beweisen, dass sie ein Geheimnis <span class="vp">s</span> kennt, ohne es zu verraten.</p>

    <div class="layout-container">

        <div class="main-content">

            <div class="card" id="modeCard">
                <h2>0. Modus wählen</h2>
                <p>Soll A ehrlich sein (kennt das Geheimnis <span class="vp">s</span>) oder lügen (kennt <span class="vp">s</span> nicht und muss raten)?</p>
                <div class="btn-group">
                    <button class="btn" onclick="chooseMode(true)">A sagt die Wahrheit</button>
                    <button class="btn btn-danger" onclick="chooseMode(false)">A lügt</button>
                </div>
                <div id="modeResult" style="margin-top: 1rem;"></div>
            </div>

            <div class="card" id="setupCard" style="display:none;">

                <img src="A.png" id="side-image2" alt="Person A">

                <h2>1. Setup (Geheimnis festlegen)</h2>

                <div class="input-group">
                    <label for="inputP">Wähle Primzahl <span class="vp">p</span>:</label>
                    <select id="inputP">
                        <option value="None"> None</option>
                        <option value="5">5</option>
                        <option value="7">7</option>
                        <option value="11">11</option>
                        <option value="13">13</option>
                        <option value="15">15</option>
                        <option value="17">17</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="inputQ">Wähle Primzahl <span class="vp">q</span>:</label>
                    <select id="inputQ">
                        <option value="None"> None</option>
                        <option value="5">5</option>
                        <option value="7">7</option>
                        <option value="11">11</option>
                        <option value="13">13</option>
                        <option value="15">15</option>
                        <option value="17">17</option>
                    </select>
                </div>
                <br>
                <label>Modulus (<span class="vo">n</span>): <input readonly type="number" id="inputN" value="35"></label>
                <span class="tooltip">ⓘ
                    <span class="tooltiptext">In echten Anwendungen werden die Primzahlen <span class="vp">p</span> und <span class="vp">q</span> deutlich größer gewählt damit es unmöglich wird aus <span class="vo">n</span> wieder <span class="vp">p</span> und <span class="vp">q</span> herauszufinden!</span>
                </span>
                <br><br>

                <label>Zufälliges Geheimnis <span class="vp">s</span>: <button class="btn" type="button" id="randomS"> Generiere</button></label>
                <br><br>
                <label>Geheimnis (<span class="vp">s</span>): <input type="number" id="inputS" value="4"></label>
                <span class="tooltip">ⓘ
                    <span class="tooltiptext">Das Geheimnis <span class="vp">s</span> muss kleiner als <span class="vo">n</span> sein, da alle Rechnungen im Modulo <span class="vo">n</span> stattfinden. Ein größeres <span class="vp">s</span> würde das gleiche Ergebnis wie (<span class="vp">s</span> mod <span class="vo">n</span>) liefern.</span>
                </span>
                <br><br>
                <button class="btn" onclick="startSetup()">Setup initialisieren</button>
                <div id="setupResult" style="margin-top: 1rem;"></div>
            </div>

            <div class="card" id="commitmentCard" style="display:none;">
                <img src="A.png" class="step-image" alt="Person A">
                <h2>2. Commitment (A)</h2>
                <div id="commitmentHonest">
                    <p>A wählt eine Zufallszahl <span class="math vp">r</span> und sendet <span class="math"><span class="vo">x</span> = <span class="vp">r</span>² mod <span class="vo">n</span></span> an B.</p>
                    <button class="btn" onclick="runCommitment()">Generiere x senden</button>
                </div>
                <div id="commitmentLying" style="display:none;">
                    <p>A kennt <span class="vp">s</span> nicht und muss raten, welches <span class="math vo">b</span> der Verifier wählen wird:</p>
                    <div class="btn-group">
                        <button class="btn" onclick="runLyingCommitment(0)">A erwartet b = 0</button>
                        <button class="btn btn-danger" onclick="runLyingCommitment(1)">A erwartet b = 1</button>
                    </div>
                </div>
                <div id="resStep1" style="margin-top: 1rem;"></div>
            </div>

            <div class="card" id="challengeCard" style="display:none;">
                <img src="B.png" class="step-image" alt="Person B">
                <h2>3. Challenge (B)</h2>
                <div id="challengeHonest">
                    <p>B wählt zufällig eine Frage (Bit <span class="math vo">b</span>).</p>
                    <div class="btn-group">
                        <button class="btn" onclick="runChallenge(0)">Frage 0: Zeig mir <span class="vp">r</span>!</button>
                        <button class="btn" onclick="runChallenge(1)">Frage 1: Zeig mir den Beweis mit <span class="vp">s</span>!</button>
                    </div>
                    <div id="resStep2" style="margin-top: 1rem;"></div>
                </div>
                <div id="challengeLying" style="display:none;">
                    <p>B wählt zufällig eine Frage — hier sehen wir <strong>beide Fälle</strong> gleichzeitig:</p>
                </div>
            </div>

            <div class="card" id="verifyCard" style="display:none;">
                <img src="B.png" class="step-image" alt="Person B">
                <h2>4. Antwort & Prüfung</h2>
                <div id="verifyHonest">
                    <div id="verifyLog"></div>
                </div>
                <div id="verifyLying" style="display:none;">
                    <div class="side-by-side">
                        <div class="side-col" id="verifyColB0">
                            <h3>Fall: <span class="vo">b</span> = 0</h3>
                            <div id="verifyLogB0"></div>
                        </div>
                        <div class="side-col" id="verifyColB1">
                            <h3>Fall: <span class="vo">b</span> = 1</h3>
                            <div id="verifyLogB1"></div>
                        </div>
                    </div>
                </div>
                <br>
                <button class="btn" onclick="resetProof()">Neue Runde starten</button>
            </div>

        </div>

        <div class="paper-sheet" id="notesSheet">
            <h3 style="text-align: center;">Werte</h3>
            <div class="paper-content">
                <div class="value-group">
                    <label class="value-private">Primzahl <span class="vp">p</span>: <input readonly type="number" id="outputP" value=""></label>
                    <br><br>
                    <label class="value-private">Primzahl <span class="vp">q</span>: <input readonly type="number" id="outputQ" value=""></label>
                    <br><br>
                    <label class="value-public">Modulus <span class="vo">n</span>: <input readonly type="number" id="outputN" value=""></label>
                </div>
                <div class="value-group">
                    <label class="value-private">Geheimnis <span class="vp">s</span>: <input readonly type="text" id="outputS" value=""></label>
                    <br><br>
                    <label class="value-public">Public Key <span class="vo">v</span>: <input readonly type="number" id="outputV" value=""></label>
                </div>
                <div class="value-group">
                    <label class="value-private">Zufallszahl <span class="vp">r</span>: <input readonly type="text" id="outputR" value=""></label>
                    <br><br>
                    <label class="value-public">Commitment <span class="vo">x</span>: <input readonly type="number" id="outputX" value=""></label>
                </div>
            </div>
            <hr>
            <div id="sideLog">
                <em></em>
            </div>
        </div>

    </div>
    <script src="script.js" defer></script>
</body>
</html>
